/*1323379162,176833974*/

if (window.CavalryLogger) { CavalryLogger.start_js(["4sKcu"]); }

var ChannelRebuildReasons={Unknown:0,AsyncError:1,TooLong:2,Refresh:3,RefreshDelay:4,UIRestart:5,NeedSeq:6,PrevFailed:7,IFrameLoadGiveUp:8,IFrameLoadRetry:9,IFrameLoadRetryWorked:10,PageTransitionRetry:11,IFrameLoadMaxSubdomain:12,NoChannelInfo:13,NoChannelHost:14,ChannelUnknown:100,ChannelNoCUser:101,ChannelInvalidCUser:102,ChannelInvalidChanstr:103,ChannelChDistribTimeout:104,ChannelGetChannelOther:105,ChannelNodeShutdown:106,ChannelTermination:107,ChannelUserMismatch:108,ChannelUserMismatchShady:109,ChannelBadXs:110,ChannelSeqNeg:111,ChannelSeqTooBig:112,ChannelSeqTooSmall:113,ChannelUnexpectedJoin:114,ChannelInvalidXsCookie:115,ChannelRelocate:116,ChannelWrongPartition:117};
var CrossDocument={};(function(){CrossDocument.setListener=function(eventHandler){if(window.postMessage){if(window.addEventListener){window.addEventListener('message',eventHandler,false);}else window.onmessage=eventHandler;}else if(document.postMessage)document.addEventListener('message',eventHandler,false);};CrossDocument.mkPostMessage=function(targetWindow,targetDocument,msgHandler){if(window.postMessage){if("object"==typeof window.postMessage){return function(message,origin){targetWindow.postMessage(message,origin);};}else return bind(targetWindow,targetWindow.postMessage);}else if(document.postMessage){return bind(targetDocument,targetDocument.postMessage);}else return bind(targetWindow,msgHandler);};CrossDocument.targetOrigin=function(parent){if(window.postMessage||document.postMessage){var parentLoc=parent.location;var parentHost=parentLoc.hostname;if(parentHost=='facebook.com'||parentHost.substring(parentHost.length-13)=='.facebook.com')return parentLoc.protocol+'//'+parentLoc.host;}else return null;};var _handleMessage=function(msgCallback,msgStr){if(!msgStr||msgStr.charAt(0)!='{')return;var msg=eval('('+msgStr+')');return msgCallback(msg);};CrossDocument.mkEventHandler=function(msgCallback){return function(event){event=event||window.event;var domain=(event.domain||event.origin);if(domain.substring(domain.length-13)!='.facebook.com'&&domain.substring(domain.length-15)!='://facebook.com'&&domain!='facebook.com')return;return _handleMessage(msgCallback,event.data);};};CrossDocument.mkMessageHandler=function(msgCallback){return function(msgStr){return _handleMessage(msgCallback,msgStr);};};})();
__e("dcode",[],function(d,f,e,c){var a,g={},b={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var i=[];for(var h in b){g[b[h]]=h;i.push(b[h]);}i.reverse();a=new RegExp(i.join("|"),'g');})();d.Dcode=e.exports={encode:function(h){return encodeURIComponent(h).replace(/([_A-Z])|%../g,function(j,i){return i?'%'+i.charCodeAt(0).toString(16):j;}).toLowerCase().replace(a,function(i){return g[i];});},decode:function(h){return decodeURIComponent(h.replace(/[_A-Z]/g,function(i){return b[i];}));}};},3);
__e("PresenceUtil",["cookie","Env","math-extensions"],function(f,h,g,e){var a=h('cookie');var b=h('Env');var c=h('math-extensions');var d=c.rand32()+1;f.PresenceUtil=g.exports={getSessionID:function(){return d;},hasUserCookie:function(){return b.user===a.get('c_user');}};},3);
__e("presence-cookie-manager",["cookie","dcode","JSLogger","json","PresenceInitialData","PresenceUtil"],function(p,r,q,o){p.CookieManager=function(){};var a=r('cookie');var b=r('dcode');var c=r('JSLogger');r('json');var d=r('PresenceInitialData');var e=r('PresenceUtil');var n=d.cookieVersion;var g=d.dictEncode;var f='presence';var m={};var j=null;var k=null;var i=c.create('presence_cookie');function h(){try{var data=a.get(f);if(j===data){return k;}else{j=data;k=null;}if(data&&data.charAt(0)=='E')data=b.decode(data.substring(1));if(data){k=JSON.parse(data);return k;}}catch(s){i.warn('getcookie_error');}return null;}function l(){return parseInt(new Date().getTime()/1000,10);}p.presenceCookieManager=q.exports={register:function(t,s){m[t]=s;},store:function(){var s=h();if(s&&s.v&&n<s.v)return;var t={v:n,time:l()};for(var w in m)t[w]=m[w]();var v=JSON.stringify(t);if(g)v='E'+b.encode(v);if(e.hasUserCookie()){var u=URI().isSecure()&&!!a.get('csm');a.set(f,v,null,null,u);}},clear:function(){a.clear(f);},getSubCookie:function(t){var s=h();if(!s)return null;return s[t];}};},3);
__e("PresenceState",["JSLogger","math-extensions","presence-cookie-manager"],function(r,u,s,q){var b=u('JSLogger');var c=u('math-extensions');var t=u('presence-cookie-manager');var a=2000;var m=[];var l=[];var p=null;var d=null;var k=null;var n=0;var g=null;var o=0;var h=b.create('presence_state');function e(){clearTimeout(p);p=null;n=Date.now();t.store();i(k);}function f(){var x={ut:n};for(var v=0,w=m.length;v<w;v++)x=m[v](x);k=x;return k;}function i(w){o++;try{n=c.verifyNumber(w.ut);if(!d)d=setInterval(j,a);k=w;if(g===null)g=w;for(var i=0;i<l.length;i++)l[i](w);}catch(v){o--;throw v;}o--;}function j(){var v=t.getSubCookie('state');if(!v)return;if(v.ut>n){i(v);return;}}t.register('state',f);(function(){var w=t.getSubCookie('state');if(!w){h.debug('null_state');i(f());return;}try{i(w);}catch(v){h.error('load_exception',{e:v.toString()});i(f());}})();r.PresenceState=s.exports={doSync:function(v){if(o)return;if(v){e();}else if(!p)p=e.defer();},registerStateStorer:function(v){m.push(v);},registerStateLoader:function(v){l.push(v);},get:function(){return k;},getInitial:function(){return g;}};},3);
__e("ChatConfig",["ChatConfigInitialData","copyProperties"],function(f,h,g,e){var b=h('ChatConfigInitialData');var d=h('copyProperties');var c={};var a=g.exports={get:function(j,i){return j in c?c[j]:i;},set:function(i){if(arguments.length>1){var j={};j[i]=arguments[1];i=j;}d(c,i);},getDebugInfo:function(){return c;}};a.set(b);},3);
__e("ShortProfiles",["arbiter","ArrayUtils","JSLogger","ObjectUtils","AsyncRequest","Env","util","copyProperties","MercuryRequireEnsure"],function(za,zc,zb,z){var a=zc('arbiter');var b=zc('ArrayUtils');var e=zc('JSLogger');var g=zc('ObjectUtils');var c=zc('AsyncRequest');var d=zc('Env');var k=zc('util');var y=zc('copyProperties');var f=zc('MercuryRequireEnsure');var w={};var l=new a();var m=[];var q=false;var s=false;var t=e.create('short_profiles');function n(){if(!m.length||q)return;q=true;o.defer();}function x(zd){var ze=[];b.createFrom(zd).forEach(function(zf){var zl={};for(var zi=0,zk=zf.ids.length;zi<zk;zi++){var zj=zf.ids[zi];if(w[zj]){zl[zj]=w[zj];}else{zl=null;break;}}if(zl){var zm={};for(var zg in zl)zm[zg]=y({},zl[zg]);try{zf.fun(zm);}catch(zh){t.error('callback_error',{e:zh});}}else ze.push(zf);});return ze;}var i='/ajax/chat/user_info.php';var j='/ajax/chat/user_info_all.php';function o(ze){l.inform('fetch');var zd=x(m);m=[];if(!zd.length)return;var zg={};zd.forEach(function(zh){zh.ids.forEach(function(zi){if(!w[zi])zg[zi]=true;});});var zf=g.getKeys(zg);new c(i).setData({ids:zf}).setHandler(function(zh){v(zh,zd);}).setErrorHandler(u).setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();}function r(){q=false;n();}function v(zf,zd){for(var ze in zf.payload){var zh=zf.payload[ze];if(!zh.type)zh.type='friend';w[ze]=zh;}if(zd)x(zd);m=x(m);r();l.inform('updated');var zg=zf.getRequest().uri.getPath();if(zg==i){t.log('fetch_response');}else if(zg==j)t.log('fetch_response_all');}function u(){t.error('fetch_error');r();}function p(){if(!s){t.log('fetch_all');s=true;new c(j).setData({viewer:d.user}).setHandler(v).setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();}}var h=y(l,{get:function(ze,zd){this.getMulti([ze],function(zf){zd(zf[ze],ze);});},getMulti:function(zf,ze){var zd={ids:zf,fun:ze};var zg=x([zd]);if(zg.length){m.push(zd);n();}},getNow:function(zd){var ze=w[zd];if(ze)return y({},ze);return null;},getCachedProfileIDs:function(){return keys(w);},hasAll:function(){return s;},fetchAll:function(){p();},set:function(zd,ze){var zf=w[zd];if(zf&&(zf.name!=ze.name||zf.firstName!=ze.firstName||zf.thumbSrc!=ze.thumbSrc))t.warn('changed',{oldInfo:zf,newInfo:ze});w[zd]=y({},ze);},setMulti:function(zd){for(var ze in zd)this.set(ze,zd[ze]);}});f.ensure(['InitialChatUserInfos'],function(zd){h.setMulti(zd);});za.ShortProfiles=zb.exports=h;},3);
__e("ServerTime",["PresenceInitialData"],function(e,g,f,d){var a=g('PresenceInitialData');var b;function c(h){b=Date.now()-h;}c(a.serverTime);e.ServerTime=f.exports={get:function(){return Date.now()-b;},getSkew:function(){return b;},update:function(h){c(h);}};},3);
__e("ChatTabModel",["ArrayUtils","JSLogger","math-extensions","MercuryAssert","PresenceState","copyProperties","arbiter"],function(zb,zd,zc,za){var b=zd('ArrayUtils');var c=zd('JSLogger');var d=zd('math-extensions');var e=zd('MercuryAssert');var f=zd('PresenceState');var z=zd('copyProperties');var x=[];var k=[];var u=null;var t=null;var m=0;var p=20;var l=c.create('chat_tab_model');var v=false;function w(ze){ze.t2=x.map(function(zf){return {i:zf};});ze.f2=u;ze.uct2=m;ze.lm2=t;return ze;}function n(zf){if(zf){var zg=d.verifyNumber(zf.uct2);if(zg>m){m=zg;l.log('load_cookie_tabs',{tabs:zf.t2,raised:zf.f2,promoted:zf.lm2});if(zf.t2){var ze=b.createFrom(zf.t2).map(function(zh){return zh.i;});o(ze,zf.f2||null,zf.lm2||null);}}}}function o(zg,zf,ze){if(y(zg,zf,ze)){if(zg.indexOf(zf)===-1)zf=null;if(zg.indexOf(ze)===-1)ze=null;x=zg;u=zf;t=ze;j();q();}}function y(zi,zh,zg){if(zh!=u)return true;if(zg!=t)return true;if(zi.length!=x.length)return true;for(var ze=0,zf=zi.length;ze<zf;ze++)if(zi[ze]!=x[ze])return true;return false;}function q(){if(v)ChatTabModel.inform('chat/tabs-changed',ChatTabModel.get());}function i(){m=Math.floor(Date.now()*.001);f.doSync();q();}function j(){var ze=x.length-p;if(ze>0)x=x.filter(function(zf){return zf==u||ze--<=0;});}function r(ze){if(x.indexOf(ze)===-1&&k.indexOf(ze)===-1){k.push(ze);return true;}return false;}function s(zf){var ze=g(zf);if(x.indexOf(zf)===-1){x.push(zf);j();ze=true;}return ze;}function g(ze){if(k.indexOf(ze)!==-1){k=k.filter(function(zf){return zf!=ze;});return true;}return false;}function h(ze){if(x.indexOf(ze)!==-1){x=x.filter(function(zf){return zf!=ze;});return true;}return false;}f.registerStateStorer(w);f.registerStateLoader(n);var a=zd('arbiter');zc.exports=ChatTabModel=z(new a(),{closeAllTabs:function(){if(x.length!==0||k.length!==0){x=[];k=[];u=null;t=null;i();}},closeFragileTabs:function(){if(k.length){k=[];q();}},closeTab:function(zf){e.isThreadID(zf);var ze=h(zf);ze|=g(zf);if(ze){if(u==zf)u=null;if(t==zf)t=null;i();}},raiseTab:function(zf){e.isThreadID(zf);var ze=s(zf);if(u!=zf){u=zf;ze=true;}if(ze)i();},get:function(){var ze=x.concat(k);return {tabs:ze,raised:u,promoted:t};},openFragileTab:function(ze){e.isThreadID(ze);if(r(ze))q();},openTab:function(ze){e.isThreadID(ze);if(s(ze))i();},lowerTab:function(ze){e.isThreadID(ze);if(u==ze){u=null;i();}},raiseAndPromoteTab:function(zf){e.isThreadID(zf);var ze=s(zf);if(u!=zf||t!=zf){u=t=zf;ze=true;}if(ze)i();}});n(f.get(),true);v=true;});
__e("ChatController",["ChatTabModel","MercuryThreads"],function(d,f,e,c){var a=f('ChatTabModel');var b=f('MercuryThreads');e.exports={raiseFragileGroupTab:function(g){b.getCanonicalThreadToGroup(g,function(h){a.openFragileTab(h.thread_id);});},raiseGroupTab:function(g){b.getCanonicalThreadToGroup(g,function(h){a.raiseTab(h.thread_id);});}};});
var PresencePrivacy=window.PresencePrivacy||(function(){var d='/ajax/chat/privacy/settings.php';var e='/ajax/chat/privacy/online_policy.php';var f='/ajax/chat/privacy/visibility.php';var a='friend_visibility';var c='visibility';var b='online_policy';var m={};var z;var p={};var q;var l;var o;var w=[];var t=false;var v=null;function g(){return Chat.getLogger('blackbird');}function j(za,zb){if(za==Env.user)return;switch(zb){case PresencePrivacy.WHITELISTED:case PresencePrivacy.BLACKLISTED:case PresencePrivacy.UNLISTED:break;default:return;}m[za]=zb;PresencePrivacy.inform('privacy-changed');}function k(za){switch(za){case PresencePrivacy.ONLINE:case PresencePrivacy.OFFLINE:break;default:return;}z=za;PresencePrivacy.inform('privacy-changed');PresencePrivacy.inform('privacy-user-presence-changed');Arbiter.inform('chat/visibility-changed',{sender:this});}function i(za){switch(za){case PresencePrivacy.ONLINE_TO_WHITELIST:case PresencePrivacy.ONLINE_TO_BLACKLIST:break;default:return;}l=za;PresencePrivacy.inform('privacy-user-presence-changed');PresencePrivacy.inform('privacy-changed');}function n(zb,za){if(v!=null)za.window_id=v.getSessionID();return new AsyncRequest().setURI(zb).setData(za);}function x(zb,za){w.push({request:zb,data:za});if(!t){next=w.shift();y(next.request,next.data);}}function y(zb,za){t=true;zb.setHandler(u.bind(this,za)).setErrorHandler(r.bind(this,za)).setTransportErrorHandler(r.bind(this,za)).setFinallyHandler(s.bind(this)).setAllowCrossPageTransition(true).send();}function u(za,zb){var zc=za.type;if(zc===a){var ze=zb.payload.user_availabilities;PresencePrivacy.inform('privacy-availability-changed',{user_availabilities:ze});for(var zd in ze)p[zd]=za.settings[zd];}else{if(zc===c){q=za.visibility;}else if(zc===b)o=za.online_policy;PresencePrivacy.inform('privacy-user-presence-response');}g().log('set_update_response',{data:za,response:zb});}function r(za,zb){if(z!==q)k(q);if(l!==o)i(o);copy_properties(m,p);PresencePrivacy.inform('privacy-changed');w=[];g().log('set_error_response',{data:za,response:zb});}function s(za){t=false;if(w.length>0){next=w.shift();y(next.request,next.data);}}function h(zb,za){require.ensure(['PresenceUtil'],function(zc){var zf=za.obj;if(zf.window_id===zc.getSessionID())return;var zd=zf.data;if(zf.event=='access_control_entry'){zd.target_ids.forEach(function(zg){j(zg,zd.setting);p[zg]=zd.setting;});}else{if(zf.event=='visibility_update'){var ze=!!zd.visibility?PresencePrivacy.ONLINE:PresencePrivacy.OFFLINE;k(ze);q=ze;}else if(zf.event=='online_policy_update'){i(zd.online_policy);o=zd.online_policy;}PresencePrivacy.inform('privacy-user-presence-response');}g().log('channel_message_received',{data:za.obj});});}require.ensure(['PresencePrivacyInitialData'],function(za){PresencePrivacy.init.bind(PresencePrivacy,za.visibility,za.onlinePolicy,za.privacyData).defer();});return copy_properties(new Arbiter(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1,init:function(zc,za,zb){z=q=zc;l=o=za;m=copy_properties({},zb);p=copy_properties({},zb);t=false;require.ensure(['PresenceUtil'],function(zd){v=zd;this.inform('initialized',this,Arbiter.BEHAVIOR_PERSISTENT);this.inform('privacy-changed');this.inform('privacy-user-presence-changed');g().log('initialized',{visibility:zc,policy:za});Arbiter.inform('chat-visibility/initialized',this,Arbiter.BEHAVIOR_PERSISTENT);Arbiter.subscribe(PresenceMessage.getArbiterMessageType('privacy_changed'),h.bind(this));Arbiter.subscribe(window.channel.ON_CONFIG,function(zf,ze){var zh=ze.getConfig('visibility',null);if(zh!==null&&typeof(zh)!=='undefined'){var zg=zh?PresencePrivacy.ONLINE:PresencePrivacy.OFFLINE;k(zg);g().log('config_visibility',{vis:zg});}}.bind(this));Arbiter.subscribe('channel/visibility-config',function(ze,zf){var zg=zf?PresencePrivacy.ONLINE:PresencePrivacy.OFFLINE;if(zg!=z){k(zg);g().log('config_visibility_old_channel',{vis:zg});}}.bind(this));}.bind(this));},setVisibility:function(zd){q=z;k(zd);var za={visibility:zd};var zc=n(f,za);var zb={type:c,visibility:zd};x(zc,zb);g().log('set_visibility',{data:za});return zd;},getVisibility:function(){return z;},setDefaultOnlinePolicy:function(zd){o=l;i(zd);var za={online_policy:zd};var zc=n(e,za);var zb={type:b,online_policy:zd};x(zc,zb);g().log('set_online_policy',{data:za});return zd;},getDefaultOnlinePolicy:function(){return l;},getFriendVisibility:function(za){return m[za]||PresencePrivacy.UNLISTED;},allows:function(za){if(this.getVisibility()===PresencePrivacy.OFFLINE)return false;var zb=this.getDefaultOnlinePolicy();return zb===PresencePrivacy.ONLINE_TO_WHITELIST?m[za]==PresencePrivacy.WHITELISTED:m[za]!=PresencePrivacy.BLACKLISTED;},setFriendVisibility:function(zd,zi){if(zd.length>0){var zh={};for(var zb=0;zb<zd.length;zb++){var zc=zd[zb];p[zc]=m[zc];zh[zc]=zi;j(zc,zi);}var zg=zi;if(zg==PresencePrivacy.UNLISTED)zg=p[zd[0]];var za={users:zd,setting:zi,setting_type:zg};var zf=n(d,za);var ze={type:a,settings:zh};x(zf,ze);g().log('set_friend_visibility',{data:za});}return zi;},setFriendVisibilityMap:function(zb,zd){for(var za in zb){p[za]=m[za];j(za,zb[za]);}var zc={type:a,settings:zb};x(zd,zc);g().log('set_friend_visibility_from_map',{data:zb});},allow:function(za){var zb=this.getDefaultOnlinePolicy()===PresencePrivacy.ONLINE_TO_WHITELIST?PresencePrivacy.WHITELISTED:PresencePrivacy.UNLISTED;return this.setFriendVisibility([za],zb);},disallow:function(za){var zb=this.getDefaultOnlinePolicy()===PresencePrivacy.ONLINE_TO_BLACKLIST?PresencePrivacy.BLACKLISTED:PresencePrivacy.UNLISTED;return this.setFriendVisibility([za],zb);},getBlacklist:function(){var zb=[];for(var za in m)if(m[za]===PresencePrivacy.BLACKLISTED)zb.push(za);return zb;},getWhitelist:function(){var zb=[];for(var za in m)if(m[za]===PresencePrivacy.WHITELISTED)zb.push(za);return zb;},getMapForTest:function(){return m;},setMapForTest:function(za){m=za;}});})();
var AvailableList=window.AvailableList||(function(){var c=5;var f=60000;var g='/ajax/chat/buddy_list.php';var e=5000;var d=1800000;var a=.005;var zj=0;var zq=false;var za=0;var zi=false;var zf=null;var x=null;var n=null;var w=0;var v=0;var m=null;var zh=false;var zg={};var u=false;var zd={};var ze={};var z={};var h=JSLogger.create('available_list');var y={'0':2,'1':1,'-1':0,'2':3};var zk={0:-1,1:1,2:0,3:2};function q(){return Chat.isOnline()?(zq?zf:x):null;}function i(zu,zs){var zt=null;switch(zu){case AvailableList.OFFLINE:zt='offline';break;case AvailableList.IDLE:zt='idle';break;case AvailableList.ACTIVE:zt='active';break;case AvailableList.MOBILE:zt='mobile';break;}h.rate(zt,zs);}function k(zs,zw,zt,zv){if(zh&&zt)zt=false;if(zs==Env.user)return;switch(zw){case AvailableList.OFFLINE:case AvailableList.IDLE:case AvailableList.ACTIVE:case AvailableList.MOBILE:break;default:return;}var zu=AvailableList.get(zs)!=zw;if(zt){zd[zs]=zw;ze[zs]=zv||(ServerTime.get()+f);delete zg[zs];}else zg[zs]=zw;if(zu){zj++;if(!n)n=zl.defer();i(zw,zt);}}function zn(zs){m=zs;Arbiter.inform('buddylist/count-changed',zs);}function zo(zs){v=new Date();z=Object.from(zs);}function zm(zs){require.ensure(['ShortProfiles'],function(zt){if(channel_manager.isShutdown()||!Chat.isOnline()){AvailableList._poller.stop();return;}w=new Date();var zv=false;if(new Date()-v>d)zv=true;zi=true;var zu=zt.getCachedProfileIDs();zs.setHandler(zc).setErrorHandler(zb).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:Env.user,available_user_info_ids:zu,force_render:true,fetch_mobile:zv}).setURI(g).setAllowCrossPageTransition(true);});}function zc(zs){require.ensure(['presence-cookie-manager','ServerTime','ShortProfiles'],function(zz,zt,zu){var zy=zs.getPayload();var zv=zy.buddy_list;if(!zv){zb(zs);return;}zt.update(zy.time);AvailableList.updateTime=zt.get();za=0;zi=false;if(zv.forcedRender)AvailableList.haveFullList=true;if(zv.availableCount!=null)zn(zv.availableCount);if(zv.mobile_friends!=null)zo(zv.mobile_friends);var zzb=zv.userInfos;if(zzb)for(var zw in zzb)zu.set(zw,zzb[zw]);var zx=zv.nowAvailableList;var zzc=zv.wasAvailableIDs;for(var zza in zg)if(AvailableList.get(zza)!==AvailableList.OFFLINE)zzc.push(zza);if(zzc){zzc.forEach(function(zzd){zg[zzd]=AvailableList.OFFLINE;});zl.defer();}u=zv.userIsIdle;zx&&AvailableList.addLegacyAvailableList(zx);if(zv.newAvailableList){AvailableList.presenceData=zv.newAvailableList;AvailableList.haveFullList=true;}zr();zz.store();});}function zb(zs){if(presence.checkMaintenanceError(zs))return;za++;zi=false;if(za>=c){zn(0);Arbiter.inform('buddylist/update-error');}}function p(){var zs={};AvailableList.getAvailableIDs().forEach(function(zt){zs[zt]={i:AvailableList.isIdle(zt)?1:0};});return zs;}function zr(){if(AvailableList.haveFullList)Arbiter.inform('buddylist/updated');}function zl(){n=null;if(AvailableList.haveFullList)zn(AvailableList.getAvailableIDs().length);Arbiter.inform('buddylist/availability-changed');}function l(zs,zu){for(var zt in zs){var zw;var zv;if(zu){zw=y[zs[zt].ol];zv=zs[zt].exp;}else if(!zs[zt]){zw=AvailableList.OFFLINE;}else if(zs[zt].i){zw=AvailableList.IDLE;}else if(zs[zt].m){zw=AvailableList.MOBILE;}else zw=AvailableList.ACTIVE;k(zt,zw,zu,zv);}}function t(){zp();if(Chat.isOnline()){AvailableList.update();}else j();}function r(){zp();if(AvailableList._channelConnection.disconnected()){j();}else if(!AvailableList.haveFulllist)AvailableList.update();}function j(){AvailableList.haveFullList=false;w=0;v=0;m=null;zg={};zd={};ze={};z={};zj++;zl();}function zp(){AvailableList._poller&&AvailableList._poller.setTimePeriod(q());}function o(){var zs={};if(!zh){var zt=AvailableList.getLegacyOverlay();if(!is_empty(zt))zs.uo=zt;}return zs;}function s(zt,zs){require.ensure(['ChatConfig'],function(zu){zs.chat_config=zu.getDebugInfo();zs.available_list_debug_info={};AvailableList.getAvailableIDs().forEach(function(zv){zs.available_list_debug_info[zv]=AvailableList.getDebugInfo(zv);});});}var b={OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,LEGACY_OVERLAY_OFFLINE:-1,LEGACY_OVERLAY_ONLINE:0,LEGACY_OVERLAY_IDLE:1,haveFullList:false,init:function(zz,zu,zy,zx,zv,zs,zt,zw){require.ensure(['ChatConfig','ChannelConnection','PresenceState'],function(zzb,zza,zzc){this._chatConfig=zzb;this._channelConnection=zza;this._presenceState=zzc;zh=this._chatConfig&&this._chatConfig.get('chat_remove_overlay');AvailableList.updateTime=zz;AvailableList.haveFullList=zu;if(zu&&zw)zo(zw);l(zy,true);AvailableList.addLegacyAvailableList(zs);zf=zx;x=zv;AvailableList._poller=new Poller(q(),zm,true);Arbiter.subscribe('chat-visibility/initialized',function(zzd){h.log('visibility_init',zzd);zp();});zn(zt);Arbiter.subscribe(JSLogger.DUMP_EVENT,s);Arbiter.subscribe('presence/restarted',AvailableList.update);require.ensure(['presence-cookie-manager'],function(zzd){zzd.register('bl',o);});if(zzb.get('blackbird')){PresencePrivacy.subscribe('privacy-changed',zl);PresencePrivacy.subscribe('privacy-availability-changed',function(zze,zzd){for(var zzf in zzd.user_availabilities)this.set(zzf,zzd.user_availabilities[zzf]);}.bind(this));PresencePrivacy.subscribe('privacy-user-presence-response',AvailableList.update);}else Arbiter.subscribe('chat/visibility-changed',t);if(zzb.get('channel_disconnect_warning'))this._channelConnection.subscribe([this._channelConnection.CONNECTED,this._channelConnection.RECONNECTING,this._channelConnection.SHUTDOWN,this._channelConnection.MUTE_WARNING,this._channelConnection.UNMUTE_WARNING],r);if(AvailableList.haveFullList){w=new Date();}else if(zq)AvailableList.update();Arbiter.inform('available-list/initialized',AvailableList,Arbiter.BEHAVIOR_PERSISTENT);}.bind(this));this.init=bagofholding;},get:function(zs){if(zs==Env.user)return AvailableList.ACTIVE;var zt=AvailableList.OFFLINE;if(zs in zd&&(ServerTime.get()<ze[zs]||!(zs in zg))){zt=zd[zs];}else if(zs in zg)zt=zg[zs];if(this._chatConfig&&this._chatConfig.get('blackbird')&&!PresencePrivacy.allows(zs))zt=AvailableList.OFFLINE;if(zt==AvailableList.OFFLINE)if(z[zs])zt=AvailableList.MOBILE;return zt;},isUserIdle:function(){return u;},isReady:function(){return AvailableList.haveFullList;},set:function(zs,zt){k(zs,zt,true);this._presenceState&&this._presenceState.doSync();},update:function(){if(new Date()-w<e){!zi&&zr.defer();return;}zq=true;zp();AvailableList._poller&&AvailableList._poller.requestNow();},getRev:function(){return zj;},isIdle:function(zs){return AvailableList.get(zs)==AvailableList.IDLE;},getCount:function(){return m;},getAvailableIDs:function(){var zs,zt=[];for(zs in zg)if(AvailableList.get(zs)!==AvailableList.OFFLINE)zt.push(zs);for(zs in zd){if(zs in zg)continue;if(AvailableList.get(zs)!==AvailableList.OFFLINE)zt.push(zs);}for(zs in z){if(zs in zg||zs in zd)continue;zt.push(zs);}return zt;},getLegacyOverlay:function(){var zt={};if(!zh){var zu=ServerTime.get();for(var zs in zd)if(ze[zs]>zu)zt[zs]={exp:ze[zs],ol:zk[zd[zs]]};}return zt;},addLegacyOverlay:function(zs){l(zs,true);this._presenceState&&this._presenceState.doSync();},addLegacyAvailableList:function(zs){l(zs,false);},getDebugInfo:function(zs){var zt;if(window.ShortProfiles){var zu=ShortProfiles.getNow(zs);if(zu)zt=zu.name;}return {id:zs,presence:zg[zs],overlay:zd[zs],overlayTime:ze[zs],mobile:z[zs],name:zt};}};require.ensure(['AvailableListInitialData'],function(zs){b.init.bind(b,zs.updateTime,true,zs.updateOverlay,zs.pollInterval,zs.lazyPollInterval,zs.availableList,zs.availableCount,zs.mobileFriends).defer();});return b;})();
if(!window.Chat){var Chat={openTab:function(a,b,d,c){if(window.External&&External.Chat&&External.Chat.openWindow)External.Chat.openWindow(a);this._trackOpenTabClick(a,c);Chat._withComponent('chatDisplay',function(e){e.focusTab(a,true,b,b,d);});},_trackOpenTabClick:function(b,c){if(c&&c=='ordered_list'||c=='more_online_friends'||c=='online_friends'||c=='typeahead'){var a={target:b,source:c};new AsyncSignal('/ajax/chat/ct.php',a).send();}},openMultichatTab:function(d,b,a,e,f,c){Chat._withComponent('chatDisplay',function(g){g.createMultichatTab(d,b,a,e,f,true,c);});},loadTabFragile:function(b,c,a,d){require.ensure(['ChatConfig'],function(e){if(e.get('mercury_integration')){require.ensure(['ChatController'],function(f){f.raiseFragileGroupTab(b);});}else Chat._withComponent('chatDisplay',function(f){f.loadTabFragile(b,c,a,d);});});},openBuddyList:function(){Chat._withComponent('buddyListNub',function(a){a.show();});},closeBuddyList:function(){Chat._withComponent('buddyListNub',function(a){a.hide();});},toggleSidebar:function(){Chat._withComponent('sidebar',function(a){a.toggle();});},goOnline:function(a){require.ensure(['ChatConfig'],function(b){if(b.get('blackbird')){PresencePrivacy.subscribe('initialized',function(){if(PresencePrivacy.getVisibility()===PresencePrivacy.OFFLINE){Chat.getLogger('blackbird').log('chat_go_online');PresencePrivacy.setVisibility(PresencePrivacy.ONLINE);}a&&a();});return;}Arbiter.subscribe('chat-options/initialized',function(event,c){if(Chat.isOnline()){a&&a();}else{if(a)var d=Arbiter.subscribe('chat/visibility-changed',function(){Arbiter.unsubscribe(d);a();});c.sendVisibility(true);}});});},isOnline:function(){var a=null;require.ensure(['ChatConfig'],function(b){a=b;});if(a){if(a.get('blackbird'))return PresencePrivacy&&PresencePrivacy.getVisibility()===PresencePrivacy.ONLINE;return window.chatOptions&&chatOptions.visibility;}return false;},squelchTab:function(a,b){Chat._withComponent('chatDisplay',function(c){c.setSquelchedTab(a,true);c.closeTab(a);});},unsquelchTab:function(a){Chat._withComponent('chatDisplay',function(b){b.setSquelchedTab(a,false);});},getActiveChats:function(){if(!window.chatDisplay)return [];return keys(chatDisplay.tabs);},hasFocusedChat:function(){return chatDisplay.hasFocusedTab();},getActiveFriendChats:function(){var a=this.getActiveChats();return a.filter(function(b){return chatDisplay.tabs[b]&&chatDisplay.tabs[b].getPostType()=='friend';});},getLogger:function(a){var b=window.channel_manager||window.channelManager;if(b&&b.getLogger)return b.getLogger(a);return JSLogger.create(a);},_componentInitEvents:{chatDisplay:'chat-display/loaded',buddyListDisplay:'buddylist-display/initialized',buddyListNub:'buddylist-nub/initialized',sidebar:'sidebar/initialized'},_withComponent:function(b,a){Arbiter.subscribe(Chat._componentInitEvents[b],function(event,c){a(c);});}};copy_properties(Chat,{updateUserInfo:bagofholding,setUserInfo:bagofholding});}
(function(){window.ChannelManager=function(b,e,d,a,c){JSLogger.create('channel_deprecated').error('manager_instantiated');this.user=e;this.iframeLoadMaxRetries=1;this.iframeLoadMaxSubdomain=6;this.expectResponseTimeout=5000;this.retryInterval=d;this.channelConfig=a;this._init(b,c);Arbiter.subscribe(JSLogger.DUMP_EVENT,function(event,f){f.transportVersion=1;});};ChannelManager.CONN_LOG_INTERVAL=10000;ChannelManager.prototype={_init:function(c,e){this.channelManagerId=rand32();this.config={};this.channel={};this.isActionRequest=true;this.isReady=false;this.isRebuilding=false;this.iframeIsLoaded=false;this.iframeEverLoaded=false;this.iframeCheckFailedCount=0;this.shouldClearSubdomain=false;this.subframe=c;Event.listen(this.subframe,'load',this._iframeLoadCheck.bind(this));this.postMessage=null;var a=presenceCookieManager.getSubCookie('ch');if(e){this.iframeSubdomain=null;}else{this.iframeSubdomain=0;if(a&&a.sub){for(var b=0;b<a.sub.length;b++)if(!a.sub[b]){this.iframeSubdomain=b;break;}if(b==a.sub.length)if(b==this.iframeLoadMaxSubdomain&&URI().isSecure()){this.iframeSubdomain=null;this._sendDummyReconnect(ChannelRebuildReasons.IFrameLoadMaxSubdomain);}else this.iframeSubdomain=a.sub.length;}}this.handleIframeEvent=CrossDocument.mkEventHandler(this._handleIframeMessage.bind(this));this.handleIframeMessage=CrossDocument.mkMessageHandler(this._handleIframeMessage.bind(this));CrossDocument.setListener(this.handleIframeEvent.bind(this));presenceCookieManager.register('ch',this._getCookieInfo.bind(this));if(typeof window.onpageshow!='undefined'){Event.listen(window,'pagehide',this._onUnload.bind(this));Event.listen(window,'pageshow',this.rebuild.bind(this,ChannelRebuildReasons.Refresh));}else onunloadRegister(this._onUnload.bind(this));this._connLogger=EagleEye.createLogger('channel-connectivity',this.getConfig('CONNECTIVITY_SAMPLING',.01));this._connTime=Env.start;this._connT=2000;this._connectivity={};(this._connSample=this._connSample.bind(this))();(this._connLog=this._connLog.bind(this))();var d=0;UserActivity.subscribe(function(){if(new Date()-d>3000){d=new Date();this.setActionRequest(true);}}.bind(this));},_connSample:function(){var a=new Date(),b=this._connState||'idle';var c=a-this._connTime;this._connAdd(b,c);this._connTime=a;setTimeout(this._connSample,1000*(1+Math.random()),false);},_connAdd:function(a,b){this._connectivity[a]=(this._connectivity[a]||0)+b;},_connLog:function(){this._connLogger(this._connectivity);this._connectivity={};this._connT=Math.min(60000,2*this._connT);setTimeout(this._connLog,this._connT,false);},sendIframeMessage:function(b){if(!this.postMessage)return;var c=JSON.stringify(b);try{this.postMessage(c,this.targetOrigin);}catch(a){this.getLogger().error('iframe_msg_error',a);}},_handleIframeMessage:function(a){require.ensure(['PresenceState'],function(b){var i=this.channel.currentSeq;var e={old_seq:i};if('seq' in a){e.new_seq=a.seq;e.seq_gap=a.seq-i;this.channel.currentSeq=a.seq;b.doSync();}switch(a.t){case 'init':this._connState=null;this.iframeLoaded();break;case 'log':break;case 'reconnect':if(window.loaded){this.getLogger().error('refresh_'+a.reason);this.rebuild(a.reason);this.channel.shutdownHandler(true);}break;case 'connectivity':delete a.t;if('state' in a){this._connState=a.state;delete a.state;}for(var h in a)this._connAdd(h,a[h]);break;case 'fullReload':this.getLogger().error('full_reload',e);presenceCookieManager.clear();Arbiter.inform('channel/invalid_history');break;case 'msg':var c=this.channel;if(a.msgs){var j=a.msgs;var k=0;for(var g=0;g<j.length;g++)if(j[g].seq!==-1)k++;var l=c.currentSeq-k;for(var g=0;g<j.length;g++){if(l>=i){var d=j[g].msg;try{c.msgHandler(c.name,d);}catch(f){this.getLogger().error('msg_handling_error',f);}}if(j[g].seq!==-1)l++;}}else{var j=a.ms;var l=c.currentSeq-j.length;for(var g=0;g<j.length;g++,l++)if(l>=i){var d=j[g];try{c.msgHandler(c.name,d);}catch(f){this.getLogger().error('msg_handling_error',f);}}}break;default:this.getLogger().error('unknown_msg_type',{type:a.t});presence.permaShutdown();this.stop();break;}}.bind(this));},_onUnload:function(){this.shouldClearSubdomain=true;presence.doSync(true);},addChannel:function(a,d,b,f,e,c){if(this.channel.name){this.getLogger().error('addchannel_called_twice');return;}this.channel={name:a,currentSeq:d,msgHandler:b,startHandler:f,shutdownHandler:e,restartHandler:c};presence.doSync();},_getCookieInfo:function(){var b={};if(this.config.host){b.h=this.config.host;if(this.config.port)b.p=this.config.port;if(null!==this.iframeSubdomain){var a=presenceCookieManager.getSubCookie('ch');var e=(a&&a.sub)?a.sub:[];var d=e.length;if(this.shouldClearSubdomain){e[this.iframeSubdomain]=0;}else{e[this.iframeSubdomain]=1;for(var c=d;c<=this.iframeSubdomain;c++)if(!e[c])e[c]=0;}b.sub=e;}b[this.channel.name]=this.channel.currentSeq;}b.ri=this.retryInterval;return b;},getConfig:function(c,b){var a=this.channelConfig;return a&&(c in a)?a[c]:b;},stop:function(){this.stopped=true;this.setReady(false);},setReady:function(a){this.isReady=a;var b={type:'isReady',isReady:a,isActionRequest:this.isActionRequest};if(a&&this.isActionRequest)this.isActionRequest=false;if(a){b.channelName=this.channel.name;b.currentSeq=this.channel.currentSeq;b.channelManagerId=this.channelManagerId;b.channelConfig=this.channelConfig;}this.sendIframeMessage(b);},setActionRequest:function(a){this.sendIframeMessage({type:'isActionRequest',isActionRequest:a});},expectResponse:function(){this.sendIframeMessage({type:'expectResponse',newTimeout:this.expectResponseTimeout});},_iframeUrl:function(a,c,b){var d;if(null===this.iframeSubdomain){d='';}else{d=this.iframeSubdomain;d+=URI().isSecure()?'-':'.';}return new URI().setDomain(d+a+'.facebook.com').setPort(c).setPath(b).setSecure(URI().isSecure()).toString();},iframeGetJS:function(){this.getLogger().log('iframe_resources');return this.config.resources;},getLogger:function(a){a=a||'channel0';return JSLogger.create(a);},iframeLoad:function(a,c){this.isReady=c;this.iframeIsLoaded=false;this.config=a;var e=this._iframeUrl(a.host,a.port,a.path);clearTimeout(this._checkTimer);this._checkTimer=this._iframeCheck.bind(this).defer(this.getConfig('IFRAME_LOAD_TIMEOUT',30000),false);var d=null;window.onchanneliframeready=this.iframeGetJS.bind(this);if(!ua.ie()||ua.ie()<8)try{d=this.subframe.contentDocument;}catch(b){}if(d){try{d.location.replace(e);}catch(b){this.getLogger().error('error_setting_location',b);}}else if(this.subframe.contentWindow){this.subframe.src=e;}else if(this.subframe.document){this.subframe.src=e;}else this.getLogger().error('error_setting_subframe_url');this.getLogger().debug('iframe_location',{url:e});},_iframeLoadCheck:function(){try{this.subframe.contentWindow.document.body.innerHTML;}catch(a){this.getLogger().error('iframe_load_check_error',{count:this.iframeCheckFailedCount,error:a.toString()});}},iframeLoaded:function(){if(!this.iframeIsLoaded){this.iframeIsLoaded=true;this.postMessage=CrossDocument.mkPostMessage(this.subframe.contentWindow,this.subframe.contentDocument,this.subframe.contentWindow.channelUplink.handleParentMessage);this.targetOrigin='*';this.setReady(this.isReady);if(this.iframeCheckFailedCount){this.channel.restartHandler(false);this._sendDummyReconnect(ChannelRebuildReasons.IFrameLoadRetryWorked);}else this.channel.startHandler();this.iframeCheckFailedCount=0;this.iframeEverLoaded=true;}},_iframeCheck:function(){delete this._checkTimer;if(!this.iframeIsLoaded){this.iframeCheckFailedCount++;var a=this.config;this.config={};presenceCookieManager.store();if(this.iframeCheckFailedCount<=this.iframeLoadMaxRetries){this.rebuild(ChannelRebuildReasons.IFrameLoadRetry);}else{this.channel.shutdownHandler();this._sendDummyReconnect(ChannelRebuildReasons.IFrameLoadGiveUp);}}else this.retryInterval=0;},_sendDummyReconnect:function(b){var a=new AsyncRequest().setURI('/ajax/presence/reconnect.php').setData({reason:b,iframe_loaded:this.iframeEverLoaded}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);a.specifiesWriteRequiredParams()&&a.send();},_rebuildResponse:function(c){var b=c.getPayload();if(!b.user_channel){this.getLogger().error('invalid_channel_name',{name:this.channel.name});presence.permaShutdown();this.stop();return;}var a=b.user_channel;this.getLogger().debug('rebuild_response',{channel:a,seq:b.seq,host:b.host,port:b.port});this.channel.currentSeq=b.seq;this.isRebuilding=false;if(b.path!=this.config.path||b.host!=this.config.host){this.iframeLoad(b,true);}else this.setReady(true);presenceCookieManager.store();Arbiter.inform('channel/visibility-config',b.visibility);this.channel.restartHandler(true);},_retryRebuild:function(c,a){var d=this.getConfig('MAX_RETRY_INTERVAL',60000);var e=this.getConfig('MIN_RETRY_INTERVAL',10000);if(a){this.retryInterval=d;}else if(this.retryInterval==0){this.retryInterval=e;}else this.retryInterval=Math.min(d,this.retryInterval*2);var b=this.retryInterval*(.75+Math.random()*.5)|0;this.getLogger().warn('manager_retrying',{delay:b});setTimeout(this._rebuildSend.bind(this,c),this.retryInterval,false);},_rebuildError:function(a,b){this.channel.shutdownHandler(true);this.getLogger().error('rebuild_error',{error:b.getErrorDescription()});if(presence.checkMaintenanceError(b)){this.getLogger().warn('mgr_maint_check_giveup');}else if(presence.checkLoginError(b)){if(presence.inPopoutWindow){this._retryRebuild(ChannelRebuildReasons.PrevFailed,true);}else this.getLogger().warn('mgr_login_check_giveup');}else this._retryRebuild(ChannelRebuildReasons.PrevFailed,false);},_rebuildTransportError:function(a,b){this.channel.shutdownHandler(true);this.getLogger().error('rebuild_transport_error',{error:b.getErrorDescription()});this._retryRebuild(a,false);},_rebuildSend:function(b){if(!presence.hasUserCookie(true))return;if(typeof b!='number')b=ChannelRebuildReasons.Unknown;this.getLogger().debug('sending_rebuild');var a=new AsyncRequest().setURI('/ajax/presence/reconnect.php').setData({reason:b,iframe_loaded:this.iframeEverLoaded}).setHandler(this._rebuildResponse.bind(this)).setErrorHandler(this._rebuildError.bind(this,b)).setTransportErrorHandler(this._rebuildTransportError.bind(this,b)).setOption('suppressErrorAlerts',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);return a.specifiesWriteRequiredParams()&&a.send();},rebuild:function(a){if(this.stopped)return;if(this.isRebuilding){this.getLogger().debug('already_rebuilding');return;}this.setReady(false);this.isRebuilding=true;this.getLogger().debug('rebuilding');if(a==ChannelRebuildReasons.RefreshDelay)this.retryInterval=this.channelConfig.MAX_RETRY_INTERVAL;setTimeout(this._rebuildSend.bind(this,a),this.retryInterval,false);}};}());
function TinyPresence(g,c,b,a,e,d,f){this.user=g;this.name=c;this.firstName=b;this.alias=a;this.sitevars=f;this.jslog=JSLogger.create('presence');this._init(d);}TinyPresence.prototype={shutdownDelay:5000,restartDelay:3000,_init:function(a){this.isShutdown=false;this.isShuttingDown=false;this.isRestarting=false;this.isPermaShutdown=false;this.shutdownTime=0;Arbiter.subscribe("page_transition",this.checkRebuild.bind(this));},init:function(){require.ensure(['PresenceUtil'],function(a){this.windowID=a.getSessionID();var c={ON_CONNECT:function(){Arbiter.inform(PresenceMessage.STARTED,{sender:this});this.restart();},ON_SHUTDOWN:function(e,d){switch(e){case channel.HINT_AUTH:return this.loginShutdown();case channel.HINT_CONN:return this.connectionShutdown();case channel.HINT_MAINT:return this.maintenanceShutdown();default:return this.permaShutdown();}}};for(var b in c)Arbiter.subscribe(channel[b],c[b].bind(this));}.bind(this));},updateServerTime:function(a){ServerTime&&ServerTime.update(a);},getTime:function(){return ServerTime&&ServerTime.get();},debug:bagofholding,warn:bagofholding,error:bagofholding,logError:bagofholding,doSync:bagofholding,pauseSync:bagofholding,resumeSync:bagofholding,handleMsg:function(a,b){this._handleMsg.bind(this,a,b).defer();},_handleMsg:function(a,b){if(typeof b=='string'){if(b=='shutdown'){this.connectionShutdown();}else if(b=='restart')if(this.isShutdown)this.restart();return;}if(this.isShutdown)return false;if(!b.type)return;Arbiter.inform(PresenceMessage.getArbiterMessageType(b.type),{sender:this,channel:a,obj:b});},checkRebuild:function(){if(!window.channel_manager)if(this.isShutdown&&!this.isPermaShutdown)channelManager.rebuild(ChannelRebuildReasons.PageTransitionRetry);},getErrorDescription:function(a){var c=a.getError();var b=a.getErrorDescription();if(!b)b="An error occurred.";if(c==1357001)b="Your session has timed out. Please log in.";return b;},checkLoginError:function(a){var b=a.getError();if(b==1357001||b==1357004||b==1348009){this.loginShutdown();return true;}return false;},checkMaintenanceError:function(a){if(a.getError()==1356007){this.maintenanceShutdown();return true;}return false;},permaShutdown:function(){this.isPermaShutdown=true;var a=_tx("Facebook {Chat} is experiencing technical problems.",{Chat:"Chat"});this.shutdown(false,a,"perma_shutdown");},loginShutdown:function(){var a="Your session has timed out. Please log in.";this.shutdown(false,a,"login_shutdown");},connectionShutdown:function(b){var a=_tx("Could not connect to Facebook {Chat} at this time.",{Chat:"Chat"});this.shutdown(b,a,"connection_shutdown");},maintenanceShutdown:function(){var a=_tx("Facebook {Chat} is down for maintenance at this time.",{Chat:"Chat"});this.shutdown(false,a,"maintenance_shutdown");channelManager.stop();},versionShutdown:function(){var a=_tx("Please refresh the page to get the latest version of Facebook {Chat}.",{Chat:"Chat"});this.shutdown(false,a,"version_shutdown");channelManager.stop();},shutdown:function(d,c,a){this.isRestarting=false;this.isShuttingDown=true;var b=Date.now();this.shutdownTime=b;if(!d){this._shutdown(c,0,a);}else setTimeout(this._shutdown.bind(this,c,b,a),this.shutdownDelay,false);},_shutdown:function(b,c,a){if(!this.isShuttingDown&&c==this.shutdownTime)return;if(c&&this.isShutdown)return;if(typeof b!='string'||!b)b=_tx("Facebook {Chat} is experiencing technical problems.",{Chat:"Chat"});if(typeof a!='string'||!a)a="undefined";this.jslog.warn("displaying_shutdown",{e:a});if(this.isShutdown)return;this.jslog.error("shutdown",{e:a});this.isShutdown=true;Arbiter.inform(PresenceMessage.SHUTDOWN,{sender:this,reason:b});},restart:function(a){this.isShuttingDown=false;this.isRestarting=true;if(!a){this._restart(0);}else this._restart.bind(this,this.shutdownTime).defer(this.restartDelay,false);},_restart:function(a){if(!this.isRestarting||(a&&a!=this.shutdownTime))return;this.isShutdown=false;Arbiter.inform(PresenceMessage.RESTARTED,{sender:this});},start:function(){Arbiter.inform(PresenceMessage.STARTED,{sender:this});},registerStateStorer:bagofholding,registerStateLoader:bagofholding,hasUserCookie:function(a){var b=this.user==getCookie('c_user');if(!b&&a)this.permaShutdown();return b;}};
function Presence(g,c,b,a,e,d,f){this.parent.construct(this,g,c,b,a,e,d,f);}Class.extend(Presence,'TinyPresence');Presence.prototype={_init:function(b){this.parent._init(b);var c=ua.safari();this.isSafari2=(c&&c<500);var a=ua.firefox();this.isFF2=(a&&a<3);this.isWindows=ua.windows();},renderLink:function(b,c,a){return '<a href="'+b+'"'+(a?a:'')+'>'+c+'</a>';},_shutdown:function(b,c,a){this.parent._shutdown(b,c,a);if((!this.isShuttingDown&&c===this.shutdownTime)||(c&&this.isShutdown))return;},_restart:function(a){this.parent._restart(a);if(!this.isRestarting||(a&&a!=this.shutdownTime))return;},isOnline:function(){return Chat.isOnline();}};
function LiveMessageReceiver(a){this.eventName=a;this.subs=null;this.handler=bagofholding;this.shutdownHandler=null;this.restartHandler=null;this.registered=false;this.appId=1;}LiveMessageReceiver.prototype.setAppId=function(a){this.appId=a;return this;};LiveMessageReceiver.prototype.setHandler=function(a){this.handler=a;this._dirty();return this;};LiveMessageReceiver.prototype.setRestartHandler=function(a){this.restartHandler=a.shield();this._dirty();return this;};LiveMessageReceiver.prototype.setShutdownHandler=function(a){this.shutdownHandler=a.shield();this._dirty();return this;};LiveMessageReceiver.prototype._dirty=function(){if(this.registered){this.unregister();this.register();}};LiveMessageReceiver.prototype.register=function(){var b=function(d,c){return this.handler(c);}.bind(this);var a=PresenceMessage.getAppMessageType(this.appId,this.eventName);this.subs={};this.subs.main=Arbiter.subscribe(a,b);if(this.shutdownHandler)this.subs.shut=Arbiter.subscribe(channel.ON_SHUTDOWN,this.shutdownHandler);if(this.restartHandler)this.subs.restart=Arbiter.subscribe(PresenceMessage.RESTARTED,this.restartHandler);this.registered=true;return this;};LiveMessageReceiver.prototype.unregister=function(){if(!this.subs)return this;for(var a in this.subs)if(this.subs[a])Arbiter.unsubscribe(this.subs[a]);this.subs=null;this.registered=false;return this;};LiveMessageReceiver.route=function(b){var a=function(c){var d=PresenceMessage.getAppMessageType(b.app_id,b.event_name);Arbiter.inform(d,c,Arbiter.BEHAVIOR_PERSISTENT);};if(b.hasCapture){new AsyncRequest().setHandler(function(c){a(c.getPayload());}).setAllowCrossPageTransition(true).handleResponse(b.response);}else a(b.response);};var init_live_message_receive=window.init_live_message_receive||function(){init_live_message_receive=bagofholding;Arbiter.subscribe(PresenceMessage.getArbiterMessageType('app_msg'),function(a,b){if(b.obj.event_name=='beep_event'){Bootloader.loadComponents('beeper',function(){Beeper.ensureInitialized();LiveMessageReceiver.route(b.obj);});}else LiveMessageReceiver.route(b.obj);});};
var ChatQuietLinks={silence:function(b){if(ua.firefox()>=4||ua.chrome())var a=Event.listen(document,'mousemove',function(){this._removeLinkHrefs(b);a.remove();}.bind(this));},_removeLinkHrefs:function(d){var c=DOM.scry(d,'a');for(var b=0;b<c.length;b++){var a=c[b].getAttribute('href');if(!a||a.charAt(0)=='#')c[b].removeAttribute('href');}}};
var OrderedFriendsList=window.OrderedFriendsList||(function(){var a=[];var b={};var c=false;return copy_properties(new Arbiter(),{init:function(d){this.init=bagofholding;a=d;a.forEach(function(f,e){b[f]=e;});c=true;this.inform('initialized',{},Arbiter.BEHAVIOR_PERSISTENT);},contains:function(d){return d in b;},compare:function(d,e){var j=OrderedFriendsList.getRank(d);var k=OrderedFriendsList.getRank(e);if(j!==k)return j-k;var h=window.ShortProfiles&&window.ShortProfiles.getNow(d);var i=window.ShortProfiles&&window.ShortProfiles.getNow(e);var f=((h||{}).name||'~').toLowerCase();var g=((i||{}).name||'~').toLowerCase();if(f!==g)return f<g?-1:1;return 0;},getList:function(){var d=$A(a);d=d.filter(function(e){var f=window.ShortProfiles&&ShortProfiles.getNow(e);return !f||f.type=="friend";});return d;},getRank:function(d){return d in b?b[d]:a.length;},isReady:function(){return c;}});})();
var ChatSidebar=window.ChatSidebar||(function(){var b=null;var a=null;var d;var k=false;var l=false;var n=false;var m=false;var r;var q;var t;var x;var y;var p;var e=null;var v=null;var z=null;var o=JSLogger.create('blackbird');var c=32;function g(za){switch(za){case channel.HINT_AUTH:return "Your session has timed out. Please log in.";case channel.HINT_CONN:return _tx("Could not connect to Facebook {Chat} at this time.",{Chat:"Chat"});case channel.HINT_MAINT:return _tx("Facebook {Chat} is down for maintenance at this time.",{Chat:"Chat"});default:return _tx("Facebook {Chat} is experiencing technical problems.",{Chat:"Chat"});}}function f(zb){var zc;if(zb>b.get('warning_countdown_threshold_msec')){var za=$N('a',{href:'#',className:'fbChatReconnectLink'},"Try again");zc=DOM._tx("Unable to connect to chat. {try-again-link}",{'try-again-link':za});}else if(zb>1000){zc=_tx("Unable to connect to chat. Reconnecting in {seconds}...",{seconds:Math.floor(zb/1000)});}else zc="Unable to connect to chat. Reconnecting...";return zc;}function h(zc,za){if(v){clearTimeout(v);v=null;}if(zc===a.SHUTDOWN){e=g(za);}else if(zc===a.CONNECTED){e=null;}else if(zc===a.RECONNECTING){var zb=za;e=f(zb);if(zb>1000){if(zb>b.get('warning_countdown_threshold_msec')){if(z){z.remove();z=null;}z=Event.listen(q,'click',function(event){if(CSS.hasClass(event.getTarget(),'fbChatReconnectLink')){a.reconnect();return false;}});}v=setTimeout(bind(null,h,zc,zb-1000),1000,false);}}i();}function i(){var ze=b.get('blackbird')?PresencePrivacy.getVisibility()===PresencePrivacy.ONLINE:Chat.isOnline();var za=false;if(!ze){var zb='fbChatGoOnlineLink';var zd=b.get('blackbird')?"Go online":"available";var zc=$N('a',{href:'#',className:zb},zd);var zf=b.get('blackbird')?DOM._tx("{=Go online} to see who's online to chat.",{'=Go online':zc}):DOM._tx("You are unavailable to chat. Let friends see you as {=available}?",{'=available':zc});DOM.setContent(q,zf);Event.listen(q,'click',function(event){if(CSS.hasClass(event.getTarget(),zb)){if(Chat.isOnline())o.error('sidebar_go_online_while_online');o.log('sidebar_go_online');Chat.goOnline();return false;}});CSS.addClass(t,'offline');}else{CSS.removeClass(t,'offline');DOM.empty(q);if(a.disconnected()){CSS.addClass(t,'error');DOM.setContent(q,e);}else CSS.removeClass(t,'error');}s();}function j(){if(!ChatSidebar.isVisible()&&m)return;n=false;CSS.hide(t);CSS.removeClass(document.documentElement,'sidebarMode');r.hide();x.getCore().reset();o.rate('sidebar_hide',m);Arbiter.inform('sidebar/hide',ChatSidebar);}function s(){OrderedFriendsList.subscribe('initialized',function(){var zb=ChatSidebar.shouldShowSidebar();CSS.conditionClass(document.documentElement,'sidebarCapable',zb);if(ChatSidebar.isEnabled()&&zb){CSS.setStyle(t,'height',y.y+'px');u();var za=y.y;$A(t.childNodes).forEach(function(zc){if(zc!==d)za-=Vector2.getElementDimensions(zc).y;});CSS.setStyle(d,'height',za+'px');this._maxItems=Math.floor((za-8)/c);r.setNumTopFriends(this._maxItems);x.getData().setMaxResults(this._maxItems);Arbiter.inform('sidebar/resized',ChatSidebar);}else j();m=true;});}function u(){if(ChatSidebar.isVisible())return;n=true;CSS.show(t);CSS.addClass(document.documentElement,'sidebarMode');r.show();o.rate('sidebar_show',m);Arbiter.inform('sidebar/show',ChatSidebar);}function w(){chatOptions.setSetting('sidebar_mode',ChatSidebar.isEnabled());new AsyncRequest('/ajax/chat/settings.php').setHandler(bagofholding).setErrorHandler(bagofholding).setData({sidebar_mode:ChatSidebar.isEnabled()}).setAllowCrossPageTransition(true).send();}return {init:function(zb,za,zc){ChatSidebar.init=bagofholding;require.ensure(['ChatConfig','ChannelConnection'],function(ze,zd){b=ze;a=zd;t=zb;r=za;x=zc;d=DOM.find(zb,'div.fbChatSidebarBody');q=DOM.find(zb,'div.fbChatSidebarMessage div.message');za.setScrollContainer(DOM.find(d,'div.uiScrollableAreaWrap'));za.subscribe(['render','show','hide'],debounce(function(){var zf=za.getRoot();var zg=ScrollableArea.getInstance(zf);zg&&zg.adjustGripper();}));ChatQuietLinks.silence(zb);Event.listen(window,'resize',s);Arbiter.subscribe('chat/option-changed',function(zg,zf){if(zf.name=="sidebar_mode"){k=!!chatOptions.getSetting('sidebar_mode');s();}});zc.subscribe(['respond','reset'],function(zf,zg){if(n)if(zg&&zg.value&&zg.value===zc.getCore().getValue()&&zc.getView().isVisible()){r.hide();}else r.show();});zc.getData().subscribe('beforeQuery',s);a.subscribe([a.CONNECTED,a.SHUTDOWN],h);if(b.get('channel_disconnect_warning')){a.subscribe(a.RECONNECTING,h);a.subscribe([a.MUTE_WARNING,a.UNMUTE_WARNING],i);}Arbiter.subscribe('buddylist-nub/initialized',function(zf,zg){Event.listen(zg.getButton(),'click',function(event){ChatSidebar.enable();return !ChatSidebar.shouldShowSidebar();});});Arbiter.subscribe('chat-options/initialized',function(zf,zg){k=!!zg.getSetting('sidebar_mode');Arbiter.subscribe('chat-visibility/initialized',function(zh){o.log('sidebar_vis_init',zh);i();Arbiter.subscribe('chat/visibility-changed',i);if(b.get('blackbird'))PresencePrivacy.subscribe('privacy-user-presence-changed',i);Arbiter.inform('sidebar/initialized',ChatSidebar,Arbiter.BEHAVIOR_PERSISTENT);});});});},disable:function(){if(!ChatSidebar.isEnabled())return;k=false;w();j();},enable:function(){if(ChatSidebar.isEnabled())return;k=true;w();s();!function(){if(ChatSidebar.isVisible())x.getCore().getElement().focus();}.defer();},hide:function(){l=true;j();},unhide:function(){l=false;s();},getBody:function(){return d;},getRoot:function(){return t;},getVisibleWidth:function(){return t&&t.offsetWidth||0;},isEnabled:function(){return k;},isViewportCapable:function(){y=Vector2.getViewportDimensions();return y.x>b.get('sidebar.minimum_width');},shouldShowSidebar:function(){return ChatSidebar.isViewportCapable()&&!l&&OrderedFriendsList.getList().length>b.get('sidebar.min_friends');},isVisible:function(){return n;},resize:s,toggle:function(){ChatSidebar.isEnabled()?ChatSidebar.disable():ChatSidebar.enable();}};})();
function PresenceIndicator(){}PresenceIndicator.prototype={init:function(b,a,d){this._id=b;this._firstname=a;this._tooltip=d;this._image=DOM.scry(this._tooltip,'i')[0];this._previousAvail=null;this._jslog=JSLogger.create('presence_indicator');Arbiter.subscribe('chat-visibility/initialized',function(e){this._jslog.log('vis_init',e);this._updateVisibility();}.bind(this));this._subscriptions=[Arbiter.subscribe(['available-list/initialized','buddylist/availability-changed'],this._updateAvailability.bind(this)),Arbiter.subscribe(['chat/visibility-changed'],this._updateVisibility.bind(this))];var c=Event.listen(this._tooltip,'click',function(){if(this._previousAvail!=AvailableList.OFFLINE)Chat.openTab(this._id);}.bind(this));onleaveRegister(function(){c.remove();while(this._subscriptions.length)Arbiter.unsubscribe(this._subscriptions.pop());}.bind(this));},_updateAvailability:function(){require.ensure(['ChatConfig'],function(a){if(!AvailableList.isReady())return;var d;var c;var b=AvailableList.get(this._id);if(b===this._previousAvail)return;this._previousAvail=b;switch(b){case AvailableList.OFFLINE:d=a.get('blackbird')?_tx("{name} is offline",{name:this._firstname}):_tx("{name} is unavailable",{name:this._firstname});c='offline';break;case AvailableList.IDLE:d=_tx("{name} is idle",{name:this._firstname});c='idle';break;case AvailableList.ACTIVE:d=a.get('blackbird')?_tx("{name} is online",{name:this._firstname}):_tx("{name} is available",{name:this._firstname});c='online';break;case AvailableList.MOBILE:d=_tx("{name} is available on mobile",{name:this._firstname});c='mobile';break;default:throw new Error('Invalid availability');}TooltipLink.setTooltipText(this._tooltip,d);CSS.setClass(this._image,c);}.bind(this));},_updateVisibility:function(){if(Chat.isOnline()){CSS.show(this._tooltip);}else CSS.hide(this._tooltip);}};
function VideoEvents(){}Function.mixin(VideoEvents,'Arbiter',{ACTIVATING:'videochat/activating',LOGGING_IN:'videochat/logging_in',GETTING_TOKEN:'videochat/getting_token',CONNECTING:'videochat/connecting',SLOW_CONDITIONS:'videochat/slow_conditions',CALL_INCOMING:'videochat/call_incoming',CALL_CONNECTED:'videochat/call_connected',GOT_CALLEE:'videochat/got_callee',CALL_HANDLED:'videochat/call_handled',CALLEE_ANSWERING:'videochat/callee_answering',FATAL_ERROR:'videochat/fatal_error',CALL_IN_PROGRESS:'videochat/call_in_progress',NOT_AVAILABLE:'videochat/not_available',SERVER_ERROR:'videochat/server_error',ACTIVATE_FAILED:'videochat/activate_failed',ACTIVATE_TIMED_OUT:'videochat/activate_failed_time',WRONG_VERSION_ERROR:'videochat/wrong_version',FATAL_PLUGIN_ERROR:'videochat/plugin_fatality',SILENT_PLUGIN_ERROR:'videochat/plugin_silent_fatality',START_CALL_UI:'videochat/start_call_ui',START_CALL:'videochat/start_call',ANSWER_CALL:'videochat/answer_call',IGNORE_CALL:'videochat/ignore_call',CANCEL_CALL:'videochat/cancel_call',INSTALL_COMPLETED:'videochat/install_completed',log:function(a){window.console&&console.log&&console.log(a);},warn:function(a){window.console&&console.warn&&console.warn(a);},error:function(a){window.console&&console.error&&console.error(a);}});
var VideoChatPlugin=function(){};Function.mixin(VideoChatPlugin,'Arbiter',{INSTALL_TYPES:{JAVA:0,MANUAL:1},isSupported:function(){var b=ua.windows()&&((ua.ie()>=7&&!ua.ie64())||ua.firefox()>=3.6||ua.chrome()>=5);var a=(ua.osx()>10.4)&&(ua.firefox()>=3.6||ua.chrome()>=5||ua.safari()>=500);return (b||a);},notifyFromApplet:function(b,a){Arbiter.inform(String(b),{args:String(a)});},isInstalled:function(){var a=false;if(VideoChatPlugin.isSupported())if(VideoChatPlugin.usesActiveX()){var c=null;try{c=new ActiveXObject('SkypeLimited.SkypeWebPlugin');a=!!c;}catch(b){}c=null;}else a=VideoChatPlugin._getInstalledVersion();return a;},usesActiveX:function(){return ua.ie()&&ua.windows()&&!ua.opera();},setLogger:function(a){VideoChatPlugin.log=a||bagofholding;},embed:function(a){Bootloader.loadComponents('VideoChatPluginCore',function(){VideoChatPlugin.embed(a);});},remove:bagofholding,_getInstalledVersion:function(){if(!navigator)return null;navigator.plugins.refresh(false);mimeHandler=navigator.mimeTypes['application/skypesdk-plugin'];return mimeHandler&&mimeHandler.enabledPlugin;}});
var VideoChatView={RINGTONE_PATH:'/sound/bling.mp3',WINDOW_NAME_COOKIE_KEY:'vcpwn',TARGET_ID_COOKIE_KEY:'vctid',inIncomingCall:false,inOutgoingCall:false,inManualInstall:false,tokens:[],init:function(){VideoChatView.subscribe(VideoEvents.CALL_INCOMING,VideoChatView._onIncomingCall);VideoChatView.subscribe(VideoEvents.START_CALL_UI,function(a,b){if(!VideoChatView.inOutgoingCall){VideoChatView.inOutgoingCall=true;if(VideoChatPlugin.isInstalled()){VideoChatView.onOutgoingCall(b.idTarget);}else VideoChatView._invokeCore('promptInstall',b.idTarget);}});if(VideoChatPlugin.isSupported())CSS.addClass(document.documentElement,'videoCallEnabled');onbeforeunloadRegister(function(){if((VideoChatView.inIncomingCall||VideoChatView.inOutgoingCall)&&!VideoChatView.inManualInstall)return "Leaving this page will end your call.";});onleaveRegister(function(){if(VideoChatView.inIncomingCall||VideoChatView.inOutgoingCall){VideoEvents.inform(VideoEvents.CANCEL_CALL,{cause:'leave:page'});VideoChatView.inIncomingCall=false;VideoChatView.inOutgoingCall=false;}});VideoChatView._checkPriorState();},subscribe:function(b,a){VideoChatView.tokens.push(VideoEvents.subscribe(b,a));},onProfileButtonClick:function(a){VideoChatView._invokeCore('onProfileButtonClick',a);},unload:function(){while(VideoChatView.tokens.length)VideoEvents.unsubscribe(VideoChatView.tokens.pop());},mightReloadPostInstall:function(){return ua.windows();},_showDialog:function(b,a){new Dialog().setAllowCrossPageTransition(true).setTop(a?85:125).setAsync(new AsyncRequest(b)).show();},_onIncomingCall:function(a,b){VideoChatView.inIncomingCall=true;VideoChatView._showDialog(URI('/ajax/chat/video/incoming_call.php').setQueryData({idTarget:b.idTarget,callId:b.callId}),true);},onOutgoingCall:function(a){VideoChatView.inOutgoingCall=true;VideoChatView._showDialog('/ajax/chat/video/outgoing_call.php?idTarget='+a);},_checkPriorState:function(){if(VideoChatView.mightReloadPostInstall()){var a=getCookie(VideoChatView.WINDOW_NAME_COOKIE_KEY);if(a){clearCookie(VideoChatView.WINDOW_NAME_COOKIE_KEY);var b=getCookie(VideoChatView.TARGET_ID_COOKIE_KEY);if(b){clearCookie(VideoChatView.TARGET_ID_COOKIE_KEY);if(getCookie(VideoChatView.TARGET_ID_COOKIE_KEY))return;if(VideoChatPlugin.isInstalled())VideoChatView.onOutgoingCall(b);}}}},_invokeCore:function(b){var a=Array.prototype.slice.call(arguments,1);Bootloader.loadComponents('VideoChatViewCore',function(){VideoChatView.initCore();VideoChatView[b].apply(VideoChatView,a);});}};
__e("GroupChatController",["arbiter","ChatConfig","dom","css-core","PageTransitions"],function(h,j,i,g){var a=j('arbiter');var c=j('ChatConfig');var d=j('dom');var b=j('css-core');var f=j('PageTransitions');function e(l,m,n){_goOnlineText=d.find(l,'.fbGroupChatGoOnline');_chatWithGroupText=d.find(l,'.fbGroupChatOpenTab');function k(){if(Chat.isOnline()){b.hide(_goOnlineText);b.show(_chatWithGroupText);}else{b.hide(_chatWithGroupText);b.show(_goOnlineText);}}_visibilitySubscription=a.subscribe('chat/visibility-changed',k);f.registerHandler(a.unsubscribe.bind(a,_visibilitySubscription));Event.listen(l,'click',function(){if(c.get('mercury_integration')){j.ensure(['ChatController'],function(o){o.raiseGroupTab(m);});}else Chat.goOnline(function(){Chat.openTab(m,n,'group');});});}i.exports=e;});
__e("presence-arbiter-message",[],function(b,d,c,a){b.PresenceMessage=c.exports={STARTED:'presence/started',SHUTDOWN:'presence/shutdown',RESTARTED:'presence/restarted',WINDOW_RESIZED:'presence/window-resized',TAB_CLOSED:'presence/tab-closed',TAB_OPENED:'presence/tab-opened',PRESENCE_UPDATER_READY:'presence/updater-ready',getAppMessageType:function(e,f){return 'presence/app_message:'+e+':'+f;},getArbiterMessageType:function(e){return 'presence/message:'+e;}};},3);