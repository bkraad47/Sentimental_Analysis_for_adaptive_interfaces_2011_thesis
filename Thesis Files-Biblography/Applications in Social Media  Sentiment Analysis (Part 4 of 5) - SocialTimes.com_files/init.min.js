(function(){var browser=(function(){var b=navigator.userAgent.toLowerCase();return{safari:/webkit/.test(b),opera:/opera/.test(b),msie:/msie/.test(b)&&!(/opera/).test(b),mozilla:/mozilla/.test(b)&&!(/(compatible|webkit)/).test(b)};})();var twitterTarget=null;var twitterOptions={};window.twitterCallback=function(obj){function node(e){return document.createElement(e);}
function text(t){return document.createTextNode(t);}
var target=document.getElementById(twitterTarget);var ul=node('ul'),li,statusSpan,timeSpan,i,max=obj.length>twitterOptions.count?twitterOptions.count:obj.length;for(i=0;i<max;i++){if(twitterOptions.ignoreReplies&&obj[i].text.substr(0,1)=='@'){continue;}
li=node('li');if(i+1==max){li.className='last';}
statusSpan=node('span');statusSpan.className='twitterStatus';timeSpan=node('span');timeSpan.className='twitterTime';statusSpan.innerHTML=obj[i].text;if(twitterOptions.enableLinks==true){statusSpan.innerHTML=statusSpan.innerHTML.linkify();}
timeSpan.innerHTML=relative_time(obj[i].created_at);if(twitterOptions.prefix){var s=node('span');s.className='twitterPrefix';s.innerHTML=twitterOptions.prefix.replace(/%(.*?)%/g,function(m,l){return obj[i].user[l];});li.appendChild(s);li.appendChild(text(' '));}
li.appendChild(statusSpan);li.appendChild(text(' '));li.appendChild(timeSpan);ul.appendChild(li);}
if(twitterOptions.clearContents){while(target.firstChild){target.removeChild(target.firstChild);}}
target.appendChild(ul);};window.getTwitters=function(target,id,count,options){if(typeof id=='object'){options=id;id=options.id;count=options.count;}
if(!count)count=1;if(options){options.count=count;if(options.ignoreReplies&&count==1){count=2;}}
twitterTarget=target;twitterOptions=options;ready(function(){var url='http://www.twitter.com/statuses/'+(options.withFriends?'friends_timeline':'user_timeline')+'/'+id+'.json?callback=twitterCallback&count='+count;var script=document.createElement('script');script.setAttribute('src',url);document.getElementsByTagName('head')[0].appendChild(script);});};function ready(callback){if(browser.mozilla||browser.opera){document.addEventListener("DOMContentLoaded",callback,false);}else if(browser.msie){document.write("<scr"+"ipt id=__ie_init defer=true src=//:><\/script>");var script=document.getElementById("__ie_init");if(script){script.onreadystatechange=function(){if(this.readyState!="complete")return;this.parentNode.removeChild(this);callback.call();};}
script=null;}else if(browser.safari){var safariTimer=setInterval(function(){if(document.readyState=="loaded"||document.readyState=="complete"){clearInterval(safariTimer);safariTimer=null;callback.call();}},10);}}
function relative_time(time_value){var values=time_value.split(" ");time_value=values[1]+" "+values[2]+", "+values[5]+" "+values[3];var parsed_date=Date.parse(time_value);var relative_to=(arguments.length>1)?arguments[1]:new Date();var delta=parseInt((relative_to.getTime()-parsed_date)/1000);delta=delta+(relative_to.getTimezoneOffset()*60);var r='';if(delta<60){r='less than a minute ago';}else if(delta<120){r='about a minute ago';}else if(delta<(45*60)){r=(parseInt(delta/60)).toString()+' minutes ago';}else if(delta<(90*60)){r='about an hour ago';}else if(delta<(24*60*60)){r='about '+(parseInt(delta/3600)).toString()+' hours ago';}else if(delta<(48*60*60)){r='1 day ago';}else{r=(parseInt(delta/86400)).toString()+' days ago';}
return r;}
String.prototype.linkify=function(){return this.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&\?\/.=]+/,function(m){return m.link(m);});};})();(function($){initTwitter();if(navigator.appName=="Microsoft Internet Explorer"){window.attachEvent("onload",correctPNG);}
$(document).ready(function(){initFeaturedJobs();initLinks();initSearchForm();initQuickRegForms();initTipForm();initPostNav();initAddThis();initMostPopular();initFreelanceMarketplace();});function correctPNG(){var arVersion=navigator.appVersion.split("MSIE");var version=parseFloat(arVersion[1]);if((version>=5.5)&&(document.body.filters)){for(var i=0;i<document.images.length;i++){var img=document.images[i];var imgName=img.src.toUpperCase();if(imgName.substring(imgName.length-3,imgName.length)=="PNG"){var imgID=(img.id)?"id='"+img.id+"' ":"";var imgClass=(img.className)?"class='"+img.className+"' ":"";var imgTitle=(img.title)?"title='"+img.title+"' ":"title='"+img.alt+"' ";var imgStyle="display:inline-block;"+img.style.cssText;if(img.align=="left")imgStyle="float:left;"+imgStyle;if(img.align=="right")imgStyle="float:right;"+imgStyle;if(img.parentElement.href)imgStyle="cursor:hand;"+imgStyle;var strNewHTML="<span "+imgID+imgClass+imgTitle+" style=\""+"width:"+img.width+"px; height:"+img.height+"px;"+imgStyle+";"+"filter:progid:DXImageTransform.Microsoft.AlphaImageLoader"+"(src=\'"+img.src+"\', sizingMethod='image');\"></span>";img.outerHTML=strNewHTML;i=i-1;}}}}
function initAddThis(){var post=$('.post');if($('.addThis',post).length===0){return;}
$.getScript('http://s7.addthis.com/js/250/addthis_widget.js?pub=mediabistro',function(){post.each(function(){var el=$('h2 a',this)?$('h2 a',this):$('h1 a',this);var permalink=el.attr('href');var title=el.attr('title');$('.addThis a',this).mouseover(function(){return addthis_open(this,'',permalink,title);}).mouseout(function(){addthis_close();}).click(function(){return addthis_sendto();}).show();});});}
function initTwitter(){var el=$('#twitters');if(!el.length)
return;var twitterID=el.attr('class');try{getTwitters('twitters',{id:twitterID,count:4,prefix:'',clearContents:true,enableLinks:true,ignoreReplies:false});}catch(e){}}
function initFeaturedJobs(){var items=$('.tickerItem');items.each(function(){var el=$(this);el.find('.nextJobLink').click(function(){el.removeClass('active').addClass('nonactive');var next=null;if(el.next().length)
next=el.next();else
next=items.first();next.removeClass('nonactive').addClass('active');return false;});});}
function initFreelanceMarketplace(){var el=$('#fm');if(el.length){el.find('.container').load('/blogshare/scripts/proxy.php?url=http://www.mediabistro.com/common_v4/modules/left_column_box_fm.asp').end().show();}}
function initSmartPrompt(obj,promptMsg){obj.blur(function(){if(this.value===''){this.value=promptMsg;}}).focus(function(){if(this.value===promptMsg){this.value='';}});}
function initTipForm(){var oTips={formEl:$('#tipsForm'),tipField:$('#tip'),messageField:$('#tipsMsg'),promptMsg:null,captchaLoaded:false,onSuccess:function(response,textStatus,xhr){if(response.indexOf('was delivered')>0){oTips.tipField.val(oTips.promptMsg);oTips.messageField.removeClass('error').addClass('success').delay(5000).fadeOut('1000',function(){$(this).empty().show();});}else{oTips.messageField.removeClass('success').addClass('error');}},onError:function(){alert('Unexpected error.  Please try again later.');},submitTipsForm:function(){if(oTips.captchaLoaded){oTips.submitTips();}else{$.get('/blogshare/scripts/captcha-token.php',function(txt){$('#tipsForm').append('<input type="hidden" name="timestamp" value="'+txt+'" />');oTips.submitTips();oTips.captchaLoaded=true;});}},submitTips:function(){oTips.messageField.removeClass('success').addClass('error');var input=oTips.tipField.val();if(input===oTips.promptMsg||input===''){oTips.messageField.html('Please enter a tip.');return;}
oTips.messageField.load('/blogshare/scripts/submit-tip.php',oTips.formEl.serialize(),oTips.onSuccess);},init:function(){this.promptMsg=this.tipField.val();initSmartPrompt(this.tipField,this.promptMsg);$('#tipsSubmit').click(this.submitTipsForm);this.formEl.submit(function(e){e.preventDefault();oTips.submitTipsForm();});}};if($('#tipsFormShell').length)
oTips.init();}
function initSearchForm(){var oSearch={inputField:$('#q'),promptMsg:null,validate:function(e){var val=this.inputField.val();if(val===this.promptMsg||val===''){e.preventDefault();return false;}
return true;},init:function(){this.promptMsg=this.inputField.val();initSmartPrompt(this.inputField,this.promptMsg);$('#searchSubmit').click(function(e){if(oSearch.validate(e)){$('#searchForm form').submit();}});$('#searchForm form').submit(function(e){return oSearch.validate(e);});}};if($('#searchForm').length)
oSearch.init();}
function initQuickRegForms(){$('.quickRegForm').each(function(i){var oQuickReg={formEl:$('#quick_reg_form_'+i),emailPrompt:$('#qrEmail_'+i).val(),zipPrompt:$('#qrZip_'+i).val(),msgField:$('#qrMsg_'+i),clearMsgField:function(){this.msgField.empty();},showError:function(){oQuickReg.msgField.html('Registration could not be completed. Please try again later.');},onSuccess:function(response,textStatus,xhr){if(response)
$('#qrContainer_'+i).html(response);else
oQuickReg.showError();},register:function(){oQuickReg.clearMsgField();if($('#qrEmail_'+i).val()===oQuickReg.emailPrompt){oQuickReg.msgField.html('Email required. ');return;}
if($('#qrZip_'+i).val()===oQuickReg.zipPrompt){oQuickReg.msgField.html('Zip code required. ');return;}
$.ajax({url:'/memberscenter/quick_mail_register.asp',data:$('#quick_reg_form_'+i).serialize(),type:'POST',success:oQuickReg.onSuccess,error:oQuickReg.showError});},init:function(){initSmartPrompt($('#qrEmail_'+i),this.emailPrompt);initSmartPrompt($('#qrZip_'+i),this.zipPrompt);this.formEl.submit(function(e){e.preventDefault();oQuickReg.register();});}};oQuickReg.init();});}
function initLinks(){$('.linksModule').each(function(){var el=$(this);var content=el.find('.links');var button=el.find('.button');el.find('.heading').toggle(function(){button.toggleClass('up','down');content.show('fast');},function(){button.toggleClass('up','down');content.hide('fast');});});}
function initFbLikeButton(){var iframe='<iframe scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:125px; height:25px;" allowTransparency="true"></iframe>';$('.fbLikeButton').each(function(){var url=$(this).find('a').attr('href');if(url){$(this).html(iframe).find('iframe').attr('src',url);}});}
function initMostPopular(){$('#fbRecommended').show();$('#popularNavFacebook').addClass('selected');$("#popularNavFacebook").click(function(){$('#fbRecommended').show();$('#mostCommented').hide();$('#popularNavFacebook').addClass('selected');$('#popularNavCommented').removeClass('selected');});$("#popularNavCommented").click(function(){$('#fbRecommended').hide();$('#mostCommented').show();$('#popularNavFacebook').removeClass('selected');$('#popularNavCommented').addClass('selected');});}
function initPostNav(){var boxes=$('#postNav .postNavLink');if(boxes.length<2)
return;var max=0;boxes.each(function(){var heigt=$(this).height();if(heigt>max)
max=heigt;});boxes.each(function(){$(this).height(max);});}})(jQuery);